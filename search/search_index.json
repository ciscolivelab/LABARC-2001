{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#sd-wan-lab-centralized-and-localized-policies","title":"SD-WAN Lab Centralized and Localized Policies","text":""},{"location":"#labarc-2001","title":"LABARC-2001","text":""},{"location":"#speakers","title":"Speakers","text":"<ul> <li>Lei Tian <code>Customer Delivery Architect, Cisco CX</code></li> <li>Oscar Eduardo Desentis Clemente <code>Customer Delivery Architect, Cisco CX</code></li> </ul>"},{"location":"aar/","title":"Centralized Policy - Application Aware Routing","text":""},{"location":"aar/#task-4-application-aware-routing-policy","title":"Task 4 Application Aware Routing Policy","text":"<p>In this task, you are going to use centralized policy to define transport preference for different applications, and verify different application uses different transport paths.  </p> <ol> <li> <p>Review the AAR policy VPN10_AAR. This policy sets transport preference for 3 business applications, DSCP46, DSCP41-31-21 and SIP Note application list and SLA list are pre-defined a.Navigate to Configuration &gt; Policies &gt; Custom Options &gt; Centralized Policy &gt; Traffic Policy  b. Open VPN10_AAR in view mode Note This rule matches on application source from prefix VPN10_Site300_Prefixes with DSCP 46. Prefer MPLS transport as long as the path meets SLA VIP09_Critical_Apps. If no path meets the SLA, follows routing to load sharing over all available paths Note This rule matches on application with DSCP 21 or DSCP 31 or DSCP 41, and use all paths that meets the SLA. If no path meets the SLA, follows routing to load sharing over all available paths Note This rule matches on application list VIP09_SIP. Prefer transport biz-internet as long as the path meets SLA VIP09_Critical_Apps. If no path meets the SLA, prefer MPLS transport. </p> </li> <li> <p>Apply AAR policy VPN10_AAR to all sites on VPN10.   a. Navigate to Configuration &gt; Policies &gt; Centralized Policy   b. Open Central-Policy-v1 in edit mode   c. Import VPN10_AAR policy    d. Click Policy Application to Apply VPN10_AAR to All Sites VPN10    e. After Add the policy to all sites, Save Policy Changes to push configuration to vSmart controllers. </p> </li> <li> <p>Verify AAR policy  a. Navigate to Monitor &gt; Devices &gt; Site300-cE1&gt; Troubleshooting&gt; Simulate Flows   b. Run simulated flow with DSCP46 to destination IP 10.10.1.1.   c. Run simulated flow with DSCP21 to destination IP 10.10.1.1.   d. Run simulated SIP flow to destination IP 10.10.1.1. </p> </li> </ol> <p> Question to think: In a scenario where both AAR and Central Data Policy match the packet, which policy takes precedence?? </p>"},{"location":"aar/#congratulation-you-have-completed-the-whole-lab","title":"Congratulation! You have completed the whole lab.","text":"<p>Back to Top</p>"},{"location":"about/","title":"About The Lab","text":""},{"location":"about/#learning-objectives","title":"Learning Objectives","text":"<p>Upon completion of this lab, you will be able to : </p> <ul> <li> <p>Use localized policy to deploy OSPF policy</p> </li> <li> <p>Use localized policy to deploy QoS policy</p> </li> <li> <p>Use centralized policy to deploy a Hub &amp; Spoke Topology</p> </li> <li> <p>Use centralized policy to deploy Application Aware Routing </p> </li> </ul>"},{"location":"about/#catalyst-sd-wan-manager","title":"Catalyst SD-WAN Manager","text":"<p>Cisco Catalyst SD-WAN Manager provides centralized configuration, management, operation, and monitoring across the entire SD-WAN fabric. You will comeplte all lab tasks using Catalyst SD-WAN Manager. </p>"},{"location":"about/#localized-policy-oveview","title":"Localized Policy Oveview","text":"<p>Localized policies are deployed and enforced locally on SD-WAN Edge devices. There are two type of localized policies. </p> <ul> <li> <p>Localized Control Policy</p> </li> <li> <p>Localized Data Policy</p> </li> </ul> <p>In this lab, you wil deploy OSPF localized control policy and QoS localized data policy using Catalyst SD-WAN Manager.</p>"},{"location":"about/#centralized-policy-overview","title":"Centralized Policy Overview","text":"<p>Centralized policy is policy applied to the whole SD-WAN fabric. Centralized policies are deployed on SD-WAN Controllers. Depends on the type of policy, enforcement of centralized policy can be either on SD-WAN controller or on SD-WAN Edge devices. There are two type of centralized policies. </p> <ul> <li> <p>Centralized Control Policy </p> </li> <li> <p>Centralized Data Policy </p> </li> </ul> <p>In this lab, you will deploy Hub &amp; Spoke centralized control policy and AAR centralized Data Policy using Catalyst SD-WAN Manager. </p>"},{"location":"access/","title":"Lab Crendential","text":"<p>Lab Access</p> <p>Below table provides the IP addresses and credentials for the devices used in this lab:</p> <p>SSH Access</p> Device IP Username Password SD-WAN Manager https://vmanage.dcloud.cisco.com:8443 admin C1sco12345 DCI-Router 198.18.133.200:19009 cisco cisco Site100-Core-VPN10 198.18.133.200:19010 cisco cisco Site100-CE1 198.18.133.200:19007 admin admin Site100-CE2 198.18.133.200:19008 admin admin Site200-CE1 198.18.133.200:19011 admin admin Site200-CE2 198.18.133.200:19012 admin admin Site300-Core-VPN10 198.18.133.200:19014 cisco cisco Site300-CE1 198.18.133.200:19015 admin admin Site400-CE1 198.18.133.200:19021 admin admin Site500-CE1 198.18.133.200:19026 admin admin Site500-CE1 198.18.133.200:19027 admin admin vManage-console 198.18.133.200:19001 admin C1sco12345 vSmart1 198.18.133.200:19003 admin admin vSmart2 198.18.133.200:19005 admin admin <p>VNC Access </p> Device IP Username Password Site300-Ubuntu-VPN10 198.18.133.200:30500 ubuntu viptela Site300-Ubuntu-VPN12 198.18.133.200:30501 ubuntu viptela Site400-Ubuntu-VPN10 198.18.133.201:30503 ubuntu viptela Site400-Ubuntu-VPN12 198.18.133.201:30502 ubuntu viptela Site500-Ubuntu-VPN10 198.18.133.201:30500 ubuntu viptela TRex2-VPN10 198.18.133.200:30503 ubuntu viptela"},{"location":"control/","title":"Centralized Policy - Hub&Spoke Topology","text":""},{"location":"control/#task-3-topology-policy","title":"Task 3 Topology Policy","text":"<p>In this task, you are going use centralized policy to build Hub and Spoke topology with site 100 and site 200 as Hub sites, Site 300, Site 400 and Site 500 as spoke sites.  </p> <ol> <li>Verify the default full mesh topology by navigate to Monitor &gt; Devices &gt; Site300-cE1 &gt; Tunnel </li> <li>Review the topology policy spoke-out. This topology policy allows tloc from hub sites; allows routes from hub sites; allows routes from remotes sites but set to hub's tlocs.   a. Navigate to Configuration &gt; Policies &gt; Custom Options &gt; Centralized Policy &gt; Topology    b. Select spoke-out and open in View mode. Review the TLOC rules and Route rules. </li> <li>Apply topology policy spoke-out to spoke sites (300,400,500) on outbound direction.   a. Navigate to Configuration &gt; Policies &gt; Centralized Policy   b. Open Central-Policy-v1 in view mode    c. Activate central policy Central-Policy-v1 to push the configuration to vSmart controller. </li> <li>Verify the hub &amp; spoke topology by navigate to Monitor &gt; Devices &gt; Site300-cE1 &gt; Tunnel  Question to think: How do you block tunnel between hub site 100 and site 200?  </li> </ol>"},{"location":"ospf/","title":"Localized Policy - OSPF","text":""},{"location":"ospf/#task-1-ospf-policy","title":"Task 1 OSPF Policy","text":"<p>In this task, you are going use localized route policy to set OSPF metrics, and another route policy block default route. </p>"},{"location":"ospf/#set-ospf-metric","title":"Set OSPF Metric","text":"<ol> <li>In Site 300, OSPF is pre-configured between core router Site300-Core-VPN10 and Site300-cE1 on service side. Mutual redistribution beteen OMP and OSPF is also enabled.  </li> <li>Verify the OSPF neighbor by navigate to Monitor &gt; Devices &gt; Site300-cE1 &gt; Real Time &gt; OSPF Neighbors </li> <li>Verify local route 131.131.131.0/24 is installed as OSPF route into the VPN 10 routing table. Navigate to Monitor &gt; Devices &gt; Site300-cE1 &gt; Real Time &gt; IP Route </li> <li>Verify omp route 131.131.131.0/24 is installed on remote site. Navigate to Monitor &gt; Devices &gt; Site400-cE1 &gt; Real Time &gt; IP Route </li> <li>Verify omp routes being redistributed into OSPF and installed on Site300-Core-VPN10     a. open mRemoteNG from jumphost's desktop     b. select Site300-Core-VPN10 from the pre-configured Putty session  Note: If you don't see pre-configured connections, check View-Connections     c. Log in with username:cisco &amp; password:cisco. Run command show ip route Note the redistributed routes are seen as E2 routes with default metric </li> <li>Add a Route Policy to set the OSPF metric of 1000 for prefixes redistributed from OMP   a. Navigate to Configuration &gt; Policies &gt; Custom Options &gt; Localized Policy &gt; Route Policy    b. Route Policy VIP18-Route-Policy is pre-configured to set OSPF metric to 1000. Click the ... to view the policy setting.    c. To add the route policy into configuration. Navigate to Configuration &gt; Policies &gt;  Localized Policy ,  select pre-configured policy Site300-Local-Policy-v1 and Click the ... to Edit the policy.    d. Select Route Policy then select Add Route Policy and Import Existing   e. Select VIP18-Route-Policy from Policy drop-down, then Import    f. Click Save Policy Changes to push configuration Site300-cE1-v1   g. Now, let's apply the Route Policy to OSPF. Navigate to Configuration &gt; Templates &gt; Feature Templates    h. Search feature template VIP18-OSPF-Neighbor and select Edit   i. Under REDISTRIBUTE section, click the Pencil icon to update omp redistritbuion setting   j. Select Global from drop-down of Route Policy, and configure VIP18-Route-Policy.   !!! Note   Make sure to enter the name correctly    k. Save the template change and push configuration to Site300-cE1   l. Log into Site300-Core-VPN10 with username:cisco &amp; password:cisco. Run command show ip route  **Note Now the OSPF E2 route has OSPF matric 1000</li> </ol>"},{"location":"ospf/#block-default-on-service-side","title":"Block Default On Service Side","text":"<p>As show below Site300-Core-VPN10 is incorrectly advertising default route to Site300-cE1. Next you are going to use local Route Policy to block default route from service side. </p> <ol> <li>Navigate to Configuration &gt; Policies &gt; Custom Options &gt; Localized Policy &gt; Route Policy   a. Click Add Route Policy to create new policy   b. Create new Route Policy OSPF-LAN with two sequence rule as show below    c. To add OSPF-LAN into configuration. Navigate to Configuration &gt; Policies &gt;  Localized Policy ,  select pre-configured policy Site300-Local-Policy-v1 and Click the ... ti Edit the policy.   d. Select Route Policy and Add Route Policy drop-down to Import Existing   e. Select OSPF-LAN from Policy drop-down, then Import    f. Click Save Policy Changes to push configuration to Site300-cE1-v1   g. Now, let's apply the Route Policy to OSPF. Navigate to Configuration &gt; Templates &gt; Feature Templates    h. Search feature template VIP18-OSPF-Neighbor and select Edit   i. Under ADVANCED section, configure OSPF-LAN as global value for Policy Name Note Make sure to enter the name correctly   j. Save the template change and push configuration to Site300-cE1   k. Verify default route is blocked from service side. Navigate to Monitor &gt; Devices &gt; Site300-cE1 &gt; Real Time &gt; IP Route  Question to think: Can you think alternate options to prevent the default route being advertised to OMP?  </li> </ol>"},{"location":"qos/","title":"Localized Policy - QoS","text":""},{"location":"qos/#task-2-qos-policy","title":"Task 2 QoS Policy","text":"<p>In this task, you are going use localized policy to configure QoS classification, makring on sevice side and QoS Map policy on WAN interface. </p>"},{"location":"qos/#qos-acl","title":"QoS ACL","text":"<ol> <li>Reivew the pre-configured QoS ACL for traffic classiciation. The ACL is configured to classify traffic based on DSCP values 46, 48, 41, 10 (and 0, or NO DSCP) and distribute it into four classes.   a. On vManage, navigate to Configuration &gt; Policies &gt; Custom Options &gt; Localized Policy &gt; Access Control Lists    b. Open VIP16_QoS_ACL in view mode.    </li> </ol>"},{"location":"qos/#qos-map","title":"QoS Map","text":"<ol> <li> <p>Review the QoS Map to be used for queue definition. Notice that it\u2019s configured with four QoS queues (one LLQ and three WRR queue).   a. On vManage, navigate to Configuration &gt; Policies &gt; Custom Options &gt; Localized Policy &gt; Forwarding Class/QoS    b. Open VIP16_QoS_Map in view mode. </p> </li> <li> <p>Attach QoS ACL and QoS Map to Localized Policy   a. Navigate to Configuration &gt; Policies &gt; Localized Policy, add open Site300-Local-Policy-v1 in Edit mode    b. Import VIP16_QoS_Map QoS Map    c. Import VIP16_QoS_ACL Access Control List Policy    d. Save policy change to push configuration to SIte300-cE1 </p> </li> <li> <p>Apply QoS ACL to LAN-facing interfaces of Site300-cE1.   a. Navigate to Configuration &gt; Templates &gt; Feature Templates. Type in Site300-cE1 and Gigabitethernet3 in the search bar.   b. Open the interface feature template in Edit mode    c. Scroll to the ACL/QoS section and configure VIP16_QoS_ACL as an ingress IPv4 ACL Note make sure to enter the name correctly </p> </li> <li> <p>Apply QoS Map to WAN interfaces of Site300-cE1   a. Navigate to Configuration &gt; Templates &gt; Feature Templates. Type in Site300-cE1 and Gigabitethernet2 in the search bar. Open it in edit mode.   b. Scroll to the ACL/QoS section and configure VIP16_QoS_Map as QoS Map. Note: make sure to enter the name correctly    c.  Repeat the steps for Gigabitethernet1 </p> </li> <li> <p>Generate some traffic by initiating ping test from router Site300-Core-VPN10.  </p> </li> <li>Monitor the traffic assignment to each class in vManage. Monitor &gt; Devices &gt; Site300-cE1&gt; QoS. Select the WAN interface GigabitEthernet1 or GigabitEthernet2 and to set the graph to Real Time. You might want to change policy rate to pps for better flow identification. Note: Depends on the destination IP you use for testing, Site300-cE1 might use GigabitEthernet1 or GigabitEthernet2 </li> <li>Log into Site300-Core-VPN10 and send 1000 packets to 10.10.1.100 (Site100 LAN side router) with   a. DSCP 48   b. DSCP 41   c. DSCP 10   d. DSCP 0 Recall the mapping between classes and queues. <pre><code>Queue 0 = LLQ = FC Control (REAL-TIME) = DSCP 46, 48  \nQueue 1 = WRR = FC STANDARD-DATA = DSCP 41  \nQueue 2 = WRR = FC BEST-EFFORT = DSCP 10  \nQueue 3 = WRR = FC DEFAULT-NO-DSCP = DSCP 0  \n</code></pre> </li> </ol>"},{"location":"qos2/","title":"Qos2","text":""},{"location":"qos2/#task-2-qos-policy","title":"Task 2 QoS Policy","text":"<p>In this task, you are going use localized policy to configure QoS classification, makring on sevice side and QoS Map policy on WAN interface. </p>"},{"location":"qos2/#qos-acl","title":"QoS ACL","text":"<ol> <li>Reivew the pre-configured QoS ACL for traffic classiciation. The ACL is configured to classify traffic based on DSCP values 46, 48, 41, 10 (and 0, or NO DSCP) and distribute it into four classes.   a. On vManage, navigate to Configuration &gt; Policies &gt; Custom Options &gt; Localized Policy &gt; Access Control Lists    b. Open VIP16_QoS_ACL in view mode.    </li> </ol>"},{"location":"qos2/#qos-map","title":"QoS Map","text":"<ol> <li> <p>Review the QoS Map to be used for queue definition. Notice that it\u2019s configured with four QoS queues (one LLQ and three WRR queue).   a. On vManage, navigate to Configuration &gt; Policies &gt; Custom Options &gt; Localized Policy &gt; Forwarding Class/QoS    b. Open VIP16_QoS_Map in view mode. </p> </li> <li> <p>Attach QoS ACL and QoS Map to Localized Policy   a. Navigate to Configuration &gt; Policies &gt; Localized Policy, add open Site300-Local-Policy-v1 in Edit mode    b. Import VIP16_QoS_Map QoS Map    c. Import VIP16_QoS_ACL Access Control List Policy    d. Save policy change to push configuration to SIte300-cE1   e. Repeat the steps to import QoS Map and QoS ACL to Site100-Local-Policy-v1 </p> </li> <li> <p>Apply QoS ACL to LAN-facing interfaces of Site100-cE1 and Site300-cE1.   a. Navigate to Configuration &gt; Templates &gt; Feature Templates. Type in Site100-cE1 and Gigabitethernet3 in the search bar.   b. Open the interface feature template in Edit mode    c. Scroll to the ACL/QoS section and configure VIP16_QoS_ACL as an ingress IPv4 ACL Note make sure to enter the name correctly    d. Navigate to Configuration &gt; Templates &gt; Feature Templates. Type in Site100-cE2 and Gigabitethernet3 in the search bar. Open the interface feature template in Edit mode.    e. Scroll to the ACL/QoS section and configure VIP16_QoS_ACL as an ingress IPv4 ACL Note make sure to enter the name correctly   f. Navigate to Configuration &gt; Templates &gt; Feature Templates. Type in Site300-cE1 and Gigabitethernet3 in the search bar. Open the interface feature template in Edit mode.    g. Scroll to the ACL/QoS section and configure VIP16_QoS_ACL as an ingress IPv4 ACL Note make sure to enter the name correctly </p> </li> <li> <p>Apply QoS Map to </p> </li> </ol>"},{"location":"topology/","title":"Lab Topology","text":"<p>The lab topology includes:</p> <ul> <li> <p>On-prem controllers : One vManage, one vBond, and two vSmart</p> </li> <li> <p>Two central locations (Hub/DC) with redundant routers</p> </li> <li> <p>Two regular branch locations</p> </li> <li> <p>One regular branch location with redundant routers</p> </li> <li> <p>MPLS and Internet connectivity per site</p> </li> <li> <p>DCI connectivity between central locations</p> </li> <li> <p>Three VPN/VRF segments: corporate (VPN 10), IoT/PCI (VPN 11) and Guest (VPN 12)</p> </li> </ul>"}]}